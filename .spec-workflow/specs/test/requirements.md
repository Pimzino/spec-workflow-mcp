# 需求文档 - 供应链金融平台优化需求

## 介绍

本需求文档涵盖供应链金融平台(V4.0.3 版本)的系统优化需求,包含 24 个优化项。这些优化主要针对企业认证、客户管理、变更流程、验证码系统、建档 OCR、银行对接、资方配置等核心业务场景,旨在提升用户体验、简化业务流程、增强系统兼容性和稳定性,为用户提供更加便捷、高效、可靠的供应链金融服务。

## 与产品愿景的一致性

这些优化需求支持平台的核心产品目标:

- **提升用户体验**: 通过简化认证流程、优化界面交互、增强容错性,降低用户操作成本
- **增强业务灵活性**: 支持更多业务场景(如简易建档、邮箱验证码、资方变更等),适应实际业务需求
- **提高系统可靠性**: 优化银行对接流程、增加异常监控预警,确保业务连续性
- **完善数据管理**: 支持配置导入导出、历史资料复用,提升运营效率

## 需求

### 需求 1: 简易建档增加字段

**用户故事:** 作为资金方,我想要在简易认证时补充法人和省市编码信息,以便委托平台代为中登登记时信息完整,符合新版中登登记要求。

#### 验收标准

1. 当用户进行简易认证时,系统应该在企业信息部分展示"注册省市"(省市选择器、非必填)和"注册地址"(多文本输入框、550 字限制、支持中文数字常用标点、非必填)字段
2. 当用户进行简易认证时,系统应该在法定代表人信息部分展示"姓名"(输入框、非必填、仅支持中英文)、"手机号码"(输入框、11 位、非必填、格式校验)、"证件类型"(单选下拉框、非必填、枚举值:二代居民身份证/护照/港澳通行证/台胞证/外国人永久居留证)、"证件有效期"(单选项+日期选择、非必填、枚举值:永久/有效期限)字段
3. 当用户填写法人姓名时,如果输入非中英文字符,系统应该实时浮层提示"只允许填写中文、英文"
4. 当用户填写手机号码时,如果格式错误或长度不符,系统应该实时浮层提示"请输入正确的手机号码"
5. 所有新增字段均为非必填项,未填写时不触发校验,不阻断流程

### 需求 2: 企业名称支持书名号

**用户故事:** 作为企业用户,我想要在录入企业名称时能够使用书名号《》,以便准确录入包含书名号的企业名称。

#### 验收标准

1. 当用户在自主认证场景录入企业名称时,如果输入包含《》以外的非法字符,系统应该实时浮层提示"公司名称含非法字符(仅限中英文、中英文括号及书名号)"
2. 当用户在建档场景(客户端建档流程、内管端平台录入/客户邀请)录入企业名称时,如果输入包含《》以外的非法字符,系统应该实时浮层提示"仅支持中英文、中英文括号及书名号输入,请修改"
3. 当用户在变更场景(客户端或平台端发起企业信息变更)录入企业名称时,如果输入包含《》以外的非法字符,系统应该实时浮层提示"仅支持中英文、中英文括号及书名号输入,请修改"
4. 当用户输入的企业名称包含书名号《》时,系统应该通过校验,允许提交

### 需求 3: 客户信息维护列表筛选条件增加客户类型

**用户故事:** 作为平台运营人员,我想要在客户信息维护列表中按客户类型筛选,以便快速查找特定类型的客户信息。

#### 验收标准

1. 当用户访问客户信息维护列表时,系统应该在筛选区域的"客户角色"后展示"客户类型"筛选字段(单选下拉框)
2. 客户类型字段枚举值应该包含:原始权益人、资产服务机构、计划管理人、主承销商、承销商、律所、评级机构、会计师事务所、发起机构、资金方、发行载体管理机构
3. 当用户同时选择多个筛选条件时,系统应该展示同时满足所有条件的客户信息
4. 当用户自定义筛选条件时,系统应该支持用户选择是否将"客户类型"设为筛选项

### 需求 4: 变更优化

**用户故事:** 作为平台运营人员或客户端用户,我想要优化变更流程的互斥机制,以便双端变更流程不会产生冲突,提高变更效率。

#### 验收标准

1. 当平台端用户点击变更按钮进入变更类型选择页但未提交时,如果用户点击返回按钮/取消/关闭页面,系统应该不生成待提交的变更数据,不阻塞客户端发起变更
2. 当客户端用户点击变更后关闭页面未提交时,系统应该不生成待提交的变更数据,不阻塞平台端发起变更
3. 当客户端与平台端同时发起变更流程时,系统应该以先完成提交操作的一端为准
4. 当一端提交后另一端也尝试提交时,系统应该通过互斥校验拦截该提交操作,避免变更流程冲突

### 需求 5: 验证码支持邮箱接收

**用户故事:** 作为客户端用户,我想要在注册、登录、密码重置、签署协议场景中选择通过邮箱接收验证码,以便在无法接收短信验证码时仍能完成操作。

#### 验收标准

1. 当用户在注册场景时,系统应该展示"邮箱接收"按钮,点击后显示邮箱输入框,验证码输入框切换为接收邮箱验证码,按钮切换为"短信接收"
2. 当用户注册时使用邮箱验证码完成流程后,系统应该在企业建档页面的"客户管理员邮箱"字段自动反显注册时使用的邮箱地址
3. 当用户在登录场景点击"邮箱接收"时,如果手机号未绑定邮箱,系统应该弹窗提示"您的账户未绑定邮箱请联系平台运营人员"(若配置了运营企微名片则展示二维码)
4. 当用户在登录场景点击"邮箱接收"时,如果手机号已绑定邮箱,系统应该切换验证码输入框为接收邮箱验证码,按钮切换为"短信接收"
5. 当用户在重置密码场景点击"邮箱接收"时,如果手机号未绑定邮箱,系统应该弹窗提示"您的账户未绑定邮箱请联系平台运营人员"
6. 当用户在协议签署场景点击"邮箱接收"时,如果账号未绑定邮箱,系统应该弹窗提示"您的账户未绑定邮箱请联系平台运营人员",如果已绑定则立即发送邮箱验证码
7. 当用户发送邮箱验证码成功后,系统应该浮层提示"已发送至邮箱,请注意查收",并进入 60 秒倒计时状态,期间按钮置灰不可点击

### 需求 6: 建档 OCR 优化

**用户故事:** 作为客户端或内管端用户,我想要上传营业执照和身份证后自动提取并反显相关信息,以便减少手工录入,提高建档效率。

#### 验收标准

1. 当用户上传营业执照影像件后,系统应该自动调用 OCR 接口提取地址信息,识别省级和市级行政区域
2. 当 OCR 识别出省市信息后,系统应该与系统维护的省市列表进行匹配查询,并将匹配到的省市名称反显到"注册省市"字段(未匹配到则不显示,反显结果可编辑)
3. 当用户上传身份证影像件后,系统应该自动调用 OCR 接口识别身份证号,按身份证编码规则(第 7-14 位)切分出生日期信息
4. 当 OCR 解析出生日期成功后,系统应该将出生日期信息反显到"出生日期"字段(解析失败则不反显,反显结果可编辑)

### 需求 7: 转让通知书取值优化

**用户故事:** 作为平台运营人员,我想要转让通知书在凭证扣收场景下动态获取凭证持有方名称,以便确保通知书内容与实际业务参与方一致。

#### 验收标准

1. 当服务费收费方式为凭证扣收时,系统应该动态获取凭证转让后的凭证持有方名称并填充到转让通知书中,而不是固定取平台运营方名称
2. 当获取凭证持有方名称后,系统应该对名称进行校验,确保名称的完整性和准确性,避免出现空值或错误名称

### 需求 8: 银行账户验证为建档非阻塞项

**用户故事:** 作为平台管理员,我想要配置银行账户是否需要小额打款,以便根据不同业务场景灵活适配验证要求,不阻塞建档流程。

#### 验收标准

1. 当平台配置"银行账户是否需要小额打款"为"不需要"时,客户端建档时银行账号维护后无小额打款验证步骤,不构成建档流程的阻塞项
2. 当平台配置"银行账户是否需要小额打款"为"需要"时,用户维护银行账户后可选择是否完成小额打款验证,均不阻塞建档流程推进
3. 当建档完成且有账户未完成小额打款验证时,系统应该在企业认证成功界面增加提示词"您的账户未完成打款验证,可进入企业账户管理菜单完成验证"
4. 当融资申请时配置为"需要"且可用账户都未验证时,系统应该提示"暂无可用的账户,请前往企业账户管理菜单完成小额打款验证",未验证账户前的选择按钮置灰不可选
5. 当融资申请时配置为"需要"且有已验证账户时,系统应该展示第一个已验证的可用账户,未验证账户前的按钮置灰不可选

### 需求 9: 红冲发票金额问题

**用户故事:** 作为供应商客户端用户或内管端用户,我想要系统支持负数金额的红冲发票处理,以便准确处理部分/全额红冲发票的业务场景。

#### 验收标准

1. 当系统接收发票接口返回数据时,如果"is_redoff": true,系统应该在发票列表的"是否红冲"字段显示"是"
2. 当用户在供应商客户端手动录入发票时,系统应该允许录入负数金额,调整金额手动录入的校验规则以支持负数
3. 当用户通过上传 Excel 表格导入发票信息时,系统应该优化表格解析逻辑,确保可正常读取负数金额
4. 当用户进行融资时,系统应该优先占用红冲发票(将红冲发票的可用金额全额冲至 0),剩余需要占用的金额再从正数发票中进行占用
5. 当内管端导入资产时,系统应该支持导入红字发票信息,金额支持负数

### 需求 10: 资方配置优化 - 支持配置导入导出

**用户故事:** 作为平台运营人员,我想要批量导入和导出资方配置信息,以便提高配置效率,减少重复操作。

#### 验收标准

1. 当用户点击"批量导入"-"下载模板"时,系统应该提供标准化的资方配置批量导入模板(xlsm 格式)
2. 当用户上传填写完成的模板文件时,系统应该自动对文件数量大小、格式、表格内的数据进行校验
3. 当文件校验失败时,系统应该展示导入失败弹窗,统计导入总数、导入成功数、导入失败数,并提供下载导入失败原因的功能
4. 当文件校验成功时,系统应该将解析后的结果正确映射并反显到系统界面,导入成功后列表内"状态"字段显示为"待提交"
5. 当用户点击"导出"按钮且有勾选数据时,系统应该仅导出所选的数据
6. 当用户点击"导出"按钮且未勾选任何数据时,系统应该默认全量导出根据筛选条件联动的数据
7. 当导出数据时,如果模板中有的字段在系统内无对应数据,系统应该在该字段映射位置导出为空值
8. 当导出多选字段时,如果存在多个选项值,系统应该以英文分号";"作为分隔符

### 需求 11: 简易开单场景下凭证转让时不能跳过底层资产上传

**用户故事:** 作为供应商用户,我想要在简易开单后转让凭证时必须补充底层资料,以便符合凭证新规要求。

#### 验收标准

1. 当用户对未上传底层材料的凭证点击凭证转让时,系统应该在凭证转让申请页展示凭证开立贸易资料上传环节
2. 当用户未上传底层材料尝试提交时,系统应该阻塞流程,要求用户补充底层资料后才可完成流转

### 需求 12: 资方配置新增服务费相关配置

**用户故事:** 作为平台运营人员,我想要在资方配置中增加服务费收费主体和收款账户字段,以便解决服务费收费主体与平台运营方不一致情况下的服务费代扣问题。

#### 验收标准

1. 当用户配置资方信息时,系统应该在账户要求部分展示"服务费收费主体"(支持模糊搜索的单选下拉选择框、必填、需是系统内已完成建档的企业名称)和"服务费收款账户"(输入框、8-30 位数字、必填)字段
2. 当用户输入的服务费收款账户不符合 8-30 位数字格式时,系统应该浮层提示"账户行号为 8-30 为数字格式"
3. 当融资申请时,系统应该从这两个字段获取服务费收费主体与账户的值

### 需求 13: 增加融资交易状态

**用户故事:** 作为平台运营人员,我想要在融资交易流程中新增"融资信息推送失败"状态,以便快速定位推送问题,及时处理异常情况。

#### 验收标准

1. 当平台向银行推送融资申请信息时,如果接口返回推送失败状态,系统应该将交易状态更新为"融资信息推送失败"(标签颜色为橙色)
2. 当交易状态更新为"融资信息推送失败"时,系统应该自动向已配置的风控审核岗人员发送邮件提醒,邮件内容包含供应商名称、资金方名称、异常接口名称、异常原因、平台地址
3. 当推送成功时,系统应该将交易状态更新为"资金方审核中"
4. 针对工商银行、中国银行、建设银行、交通银行、招商银行、中信银行、民生银行、浦发银行、浙商银行、兴业银行、上海银行、平安银行、光大银行等不同银行,系统应该根据各自接口的返回状态码正确判定推送成功或失败

### 需求 14: 平台服务费银行代扣优化 - 一致性校验与异常邮件预警

**用户故事:** 作为平台运营人员,我想要系统自动校验银行推送的平台服务费值与系统值是否一致,并在不一致时触发邮件通知,以便及时发现并处理异常。

#### 验收标准

1. 当平台服务费支付方式为银行代扣且交易状态为交易成功且银行接口有返回时,系统应该将银行推送的服务费值与系统中的平台服务费用进行校验,但不覆盖系统值
2. 当校验发现数值不一致或银行返回值为空时,系统应该自动触发异常邮件通知已配置的风控审核岗人员
3. 邮件模版应该包含:【服务费异常提醒】,融资编号{融资编号}的交易,资金方{资金方名称}回调与平台系统服务费值不符,请登录{平台地址}查看

### 需求 15: 手机号内管端与客户端注册兼容

**用户故事:** 作为用户,我想要同一手机号可以分别在内管端和客户端各注册 1 个账号,以便灵活使用平台服务。

#### 验收标准

1. 当用户使用已在客户端注册的手机号在平台端新增平台端用户时,系统应该不阻塞新增流程,不提示"手机号已被使用"
2. 当用户使用已在平台端注册的手机号在平台端新增客户端客户信息时,系统应该不阻塞新增流程,不提示"客户管理员手机号已存在,请检查姓名是否录入正确"
3. 当用户使用已在平台端注册的手机号通过批量导入新增客户信息时,系统应该不阻塞新增流程,不弹窗报错
4. 当用户使用已在平台端注册的手机号在客户端注册时,系统应该不阻塞注册流程,不提示"手机号已被使用"
5. 当用户变更客户管理员手机号为已在平台端注册的手机号时,系统应该不提示"手机号已被其他账号绑定",不阻塞变更流程

### 需求 16: 企业名称兼容中英文括号

**用户故事:** 作为用户,我想要系统在识别企业名称时不区分中英文括号,以便避免同一企业因括号格式差异被判定为两个不同主体。

#### 验收标准

1. 当用户在企业注册认证、企业信息变更、查询与搜索、数据统计与报表环节输入企业名称时,系统应该将中文括号与英文括号识别为一致,无格式差异区分
2. 当系统存储企业名称时,应该按照客户输入的来存储,但在校验企业是否已存在时去掉中英文括号的影响因素
3. 当系统使用 OCR、企信宝、企查查等第三方服务进行企业信息对比时,应该兼容中英文括号的差异

### 需求 17: 客户端邀请企业入驻短信通知模版优化

**用户故事:** 作为被邀请的企业用户,我想要在收到邀请短信时能看到被邀请的具体企业名称,以便识别被邀请的企业。

#### 验收标准

1. 当客户端用户发起"邀请供应商"操作时,系统应该发送短信通知,内容为"尊敬的客户,{核心企业名称}邀请您的企业{供应商名称}入驻供应链金融服务平台,请联系企业被授权人在平台完成企业账户注册,平台的访问地址为:{platUrl}"

### 需求 18: 客户端菜单名称修改

**用户故事:** 作为客户端用户,我想要看到更直观的菜单名称,以便更好地理解菜单功能。

#### 验收标准

1. 当用户访问客户端时,系统应该将菜单名称"价格行情维护"更新为"融资交易大厅"

### 需求 19: 同一凭证融资申请时可选择引用已上传过的合同发票

**用户故事:** 作为供应商用户,我想要在同一凭证多次融资申请时能复用已上传的合同发票,以便减少重复上传,提高申请效率。

#### 验收标准

1. 当用户针对同一凭证再次发起融资申请时,系统应该展示【上传历史合同/订单】【上传历史发票】按钮
2. 当用户点击按钮进入历史列表时,系统应该支持单选或多选历史合同订单或发票,列表按上传时间由近到远排序
3. 当用户选择的发票已被占用过且历史资金方或当前资金方不支持发票部分占用时,系统应该在点击【提交】时提示"以下发票存在使用记录,不满足资方融资要求,请更换!发票号码:【发票号码】"并阻拦流程
4. 当用户选择的发票本次占用金额大于发票剩余可用金额时,系统应该在填写本次占用金额后提示"发票剩余可用金额不足,请调整本次占用金额"

### 需求 20: 客户端经办人配置优化

**用户故事:** 作为企业管理员,我想要能够删除、冻结和编辑经办人账号,以便应对经办人离职、调岗等变动情况。

#### 验收标准

1. 当企业管理员对账号状态为"未激活"的经办人点击删除时,系统应该弹窗二次确认"确认删除此用户信息吗?删除后将不可恢复,请谨慎操作",确认后执行删除操作,删除仅作用于本企业下的目标经办人角色账号
2. 当企业管理员对账号状态为"已激活"的经办人点击冻结时,系统应该执行冻结操作,冻结仅作用于本企业下的目标经办人角色账号
3. 当企业管理员点击编辑经办人时,系统应该支持编辑用户名称

### 需求 21: 开单绑定资金方后支持内管变更资金方

**用户故事:** 作为平台运营人员,我想要在开立凭证绑定资金方后能变更资金方,以便在"供应商已签收但未融资"且"原资金方对核企授信不足"的情况下无需重新走开单全流程。

#### 验收标准

1. 当用户在资产维护菜单查看资产状态为已开单且资金方不为空的资产时,系统应该在操作列展示【变更资金方】按钮
2. 当该资产下有凭证存在在途融资业务或已完成融资时,系统应该不允许变更资金方
3. 当用户点击变更资金方时,如果新资金方确权模式与原资金方不一致,系统应该提示"资金方确权模式与原资金方不一致,无法变更",阻塞变更流程
4. 当用户点击变更资金方时,如果新旧资金方的付款承诺函模板不一致,系统应该提示"向资金方推送的付款承诺函模版不一致,无法变更",阻塞变更流程
5. 当用户点击变更资金方时,如果资产下凭证层级不在新资方配置的凭证层级范围内,系统应该提示"该笔资产下的可用凭证均不在新资方配置的凭证层级范围内,无法变更",阻塞变更流程
6. 当用户点击变更资金方时,如果凭证资产金额超出额度限制,系统应该提示"当前凭证资产金额超出额度限制,无法变更",阻塞变更流程
7. 当已上传底层贸易材料且贸易材料不全时,系统应该弹窗提示"底层贸易材料不全,请上传",点击【确定】进入资产编辑页面补充资料

### 需求 22: 上传合同发票优化提示语

**用户故事:** 作为供应商用户,我想要在上传合同和发票时看到明确的提示语,以便了解上传要求,减少重复操作。

#### 验收标准

1. 当用户上传合同时,系统应该展示提示语"合同完整、清晰无遮挡"
2. 当用户录入发票时,系统应该展示提示语"发票完整、清晰无遮挡"
3. 提示语应该在底层贸易材料上传、融资申请、凭证转让时的合同上传与发票录入场景中展示

### 需求 23: 项目联调反馈优化

**用户故事:** 作为平台运营人员或供应商用户,我想要系统修复项目联调中发现的问题,以便保证业务流程正常运行。

#### 验收标准

1. 当用户在准入阶段删除影像件后点击【取消】退出,再次进入时,系统应该重新获取建档影像数据,影像件正常反显
2. 当供应商进行资方准入时,如果资方配置准入维度包含凭证开立方/授信企业,系统应该将核心企业字段改为文本输入框,由供应商手工录入,完全匹配系统中认证成功的核企时继续准入步骤,否则提示"核心企业名称有误,请确认后重新输入!"
3. 当推送交行流转轨迹时,如果转出方和转入方为同一企业,系统应该过滤掉该笔流转记录
4. 当供应商向民生银行融资申请时,系统应该调用【客户开户情况查询】接口判断是否有本行户,若有本行户但未维护民生银行账户,提示"当前资方需要民生银行账户作为收款账户,请前往企业账户管理菜单中维护您的民生银行账户"
5. 当供应商在建行合同待办中点击【签署】时,系统应该先调用【JX1111 融资结果查询】接口,若查询结果为【FINANWCED-已放款】、【废弃】时自动更新状态并提示"该笔业务申请交易状态为【交易状态】,无需再签署合同,请到交易台账查询"
6. 当推送招行融资申请时,系统应该按照招行要求调整凭证流转轨迹传值、发票关联贸易合同编号、附件名长度限制、金额字段传值位数

### 需求 24: 新增合同信息后将买卖方信息同步至标品

**用户故事:** 作为平台运营人员,我想要在底层资产审核新增合同时同步买卖方信息至凭证业务系统,以便融资推送时能正常获取买卖方信息。

#### 验收标准

1. 当用户在底层资产审核(运营子系统)通过【新增】功能添加合同信息时,系统应该将买卖方信息同步至凭证业务系统的 contract_trade_info 表
2. 当融资推送时,系统应该能正常获取买卖方信息,不出现字段为空的情况

## 非功能性需求

### 代码架构和模块化

- **单一职责原则**: 每个服务模块应该有明确的职责边界,如认证服务、OCR 服务、银行对接服务等应该相互独立
- **模块化设计**: 建档、变更、融资等业务流程应该基于可复用的组件构建,支持灵活组合
- **依赖管理**: 最小化模块之间的耦合,使用接口和事件进行模块间通信
- **清晰的接口**: 前后端交互、微服务间调用应该定义清晰的 API 契约和数据格式

### 性能

- OCR 识别响应时间应在 3 秒内完成
- 批量导入导出操作应支持至少 1000 条数据的处理
- 银行接口调用超时时间应设置合理阈值,并有重试机制
- 页面加载时间应控制在 2 秒以内
- 数据库查询应有适当的索引优化

### 安全性

- 所有用户输入必须进行严格的格式校验和防注入处理
- 敏感信息(如手机号、身份证号)应加密存储
- 验证码发送应有频率限制,防止恶意刷验证码
- 文件上传应检查文件类型、大小,防止恶意文件上传
- 银行接口调用应使用安全的加密通信协议
- 操作日志应完整记录,支持审计追溯

### 可靠性

- 系统应有完善的异常处理机制,避免因单个模块异常导致整体崩溃
- 关键业务操作(如融资推送)应有失败重试机制
- 数据库操作应使用事务保证数据一致性
- 邮件通知、短信发送失败应有告警机制
- 系统应有健康检查机制,及时发现和定位问题

### 可用性

- 界面交互应符合用户操作习惯,提示信息清晰易懂
- 错误提示应明确指出问题所在和解决方法
- 表单填写应支持自动保存,避免数据丢失
- 支持主流浏览器(Chrome、Firefox、Safari、Edge 最新两个版本)
- 移动端小程序应适配主流手机分辨率
- 系统应有操作引导和帮助文档

### 可维护性

- 代码应有充分的注释和文档
- 配置项应支持动态调整,无需重启服务
- 应有完善的日志记录,便于问题排查
- 应有自动化测试覆盖核心业务流程
- 应支持灰度发布和快速回滚
